## 第二章 套接字类型与协议设置

### 关于协议

计算机领域的协议是：计算机间对话必备通信规则。协议可以说几乎是网络编程的全部内容。

### 创建套接字

```c
int socket(int domain, int type, int protocol);
```

参数说明

#### 第一个参数（domain）

表示协议族，该参数传递套接字中使用的协议分类信息。

- PF_INET：IPv4互联网协议族
- PF_INET6：IPv6互联网协议族
- PF_LOCAL：本地通信的UNIX协议族
- PF_PACKET：底层套接字的协议族
- PF_IPX：IPX Novell协议族

#### 第二个参数（type）

指套接字的数据传输方式，在同一协议族下有不同的数据传输方式。

##### 面向连接的套接字SOCK_STREAM

传输特点：

- 传输过程数据不会消失
- 按序传输数据
- 传输的数据不存在数据边界：比如传输数据的计算机通过3次调用write函数传递了100字节的数据，但接受计算机只是调用了一次read函数就接受了全部100个字节

收发数据的套接字内部有缓冲，即字节数组。通过套接字传输的数据将保存到该数组。因此收到数据并一定马上就调用read函数，只要不超过数组容量，就有可能在数据填充满缓冲之后通过一次read函数读取全部数据，当然也可以通过多次read函数进行读取。

在面向连接的套接字中，read函数和write函数的调用次数并无太大意义。

套接字缓冲已满并不意味只数据会丢失，例如当接收方的read函数比发送方的write读取速度慢时，套接字缓冲可能会被填满，即使这样也不会丢失数据，因为传输套接字会暂时停止传输。

总的来说就是面向连接的套接字会根据接收端的状态传输数据，如果传输出错还会提供重传服务。

因此面向连接的套接字除特殊情况外不会发生数据丢失。