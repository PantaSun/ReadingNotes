## DNS

**DNS（Domain Name System）**可以将域名字符串自动转换为具体的IP地址。

**域名：** 为了识别主机名称和组织机构名称的一种具有分层的名称。

**域名服务器：**指管理域名的主机和相应的软件

**DNS解析器：**进行DNS查询的主机和软件叫DNS解析器。个人电脑和工作站都属于解析器。

### DNS查询

一个主机访问一个域名时，先在自己所属的域名服务器中进行查询，若存在该域名就将该域名对应的IP地址返回。若未找到，域名服务器就向上一层域名服务器查询，依次类推。若一直到根域名服务器也没找到该域名，那就从根域名服务器开始按顺序从根往下层遍历，直到找到该域名为止。



## ARP

**ARP（Address Resolution Protocol）地址转换协议：**是一种把IP地址解析成对应主机MAC地址的协议。这里不光要解析目标IP地址的MAC地址，还要以目标IP地址为线索解析出下一个应该接收数据分包的网络设备对应的MAC地址。就是给定你一个目标IP地址，ARP可以把到达该目标所经过的网络设备的MAC地址都依次解析出来。即使目标主机不在同一个链路上，ARP也能给出下一跳路由器的IP地址。该协议只适用于IPv4，不适合IPv6.

### ARP如何得到MAC地址

发送端主机向数据链路广播一个ARP请求包，其中包含目标IP地址。同一个链路上的所有主机都能收到这个请求包并将包解析，若ARP请求包中的IP地址与自己的IP地址一致，那么该主机就会发送一个包含本机MAC地址的ARP响应包返回给发送端主机。

当知道一个IP地址对应的MAC地址后，为了避免下次请求相同的IP地址是再发一次ARP请求包，本次请求得到的结果会被缓存一段时间，一般会在内存中建一个ARP表。

发送端发送的ARP请求包中应标明自身的MAC地址和IP地址，这样目标主机就可以根据这个MAC和IP地址发送ARP响应包了，要不然目标主机都不知道把ARP响应包发给谁。

### 为何不直接使用MAC地址

为什么不直接使用MAC地址而是要在直到IP地址后才进行通信。

在同一个链路中，若只直到目标主机的MAC地址确实可以进行通信；但是在用一个路由器连接起来的不同的两个链路中通信时，假设链路1中的主机1想要和链路2中的主机2通信，也就是说主机1只是知道主机2的MAC地址时，数据是无法直接发送到主机2的，因为主机1发送的数据包必须经过路由器（有一种直接广播的情况可以做到，但是为了安全起见，路由器都禁止直接广播了），这时主机1却不知道路由器的MAC地址，这样就无法通信了。

在实际情况中，数据包在链路中流动时，目标IP地址一直未变，但是目标MAC地址会根据数据链路的不同而改变，如此看来这个两个地址缺一不可。

从反面来说，若不使用IP地址而使用MAC地址链接全世界的所有主机和结点，这里的MAC地址是无法指出目标主机的具体位置的，但是使用IP地址时，IP地址中的网络标识部分就可以充当提供位置的作用。只使用MAC地址也就要求网桥要学习更多MAC地址，这就需要维护一张巨大的表，这是不现实的。



### RARP

RARP（Reverse Address Resolution Protocol）将ARP反过来，从MAC地址定位IP地址的一种协议。

## ICMP

**ICMP（Internet Control Messages Protocol）因特网信报控制协议**是一种辅助IP的协议

主要功能包括：确认IP包是否成功送达目标地址，通知在发送过程中IP包被丢弃的原因，改善网络设置等。

ICMP消息大致可分为两类：

- 一类是通知出错原因的错误消息
- 一类是用于诊断的查询消息



## DHCP

**DHCP（Dynamic Host Configuration Protocol）动态主机配置协议**

该协议具有自动设置IP地址、统一管理IP地址分配等功能。

要使用DHCP协议首先要有一台DCHP服务器，而在很多时候该网段的路由器充当DHCP服务器的作用

### DHCP工作机制

#### 大致分为两个阶段：

**第一阶段**

- 步骤一：一台主机介入到链路中后会向链路中发送DHCP发现包，要求DHCP服务器为其设置IP地址
- 步骤二：DHCP服务器收到发现包后，向该主机发送DHCP提供包，通知可以使用的网络配置

**第二阶段**

- 步骤三：主机向链路发送DHCP请求包，通知DHCP服务器自己想使用的步骤二中提供的设置
- 步骤四：服务器发送提供包，通知主机允许其使用步骤三中提到的设置



DHCP发现包和请求包在发送时，由于没有确定好IP地址，且主机也不知道DHCP服务器的地址，所以发现包的目的地址是广播地址：255.255.255.255，源地址为0.0.0.0表示未知。

有的网络中为了避免一台DHCP服务器故障而导致无法继续分配IP这个情况就使用多台DHCP服务器，多台服务器在分配IP地址时容易产生冲突，所以DHCP服务器在分配前和主机在使用得到的IP地址前都要检查这个IP地址：

- DHCP服务器：在分配IP地址前发送ICMP回送请求包，确认没有返回应答
- DHCP主机（客户端）：针对从DHCP服务器那获得的IP地址发送ARP请求包，确认没有返回应答。



## NAT

Network Address Translator：用于本地私有网络中使用的私有地址在连接到互联网上时转而使用全局地址的技术。

在NAT路由器中有一张自动生成的表，该表用来转换地址。

NAT-PT技术可以将IPv6的首部转换为IPV4首部的一种技术。



## IP隧道

在网络层的首部后面继续追加网络层首部的通信方法叫隧道。

具体可以用在一个IPv4网络连接两个IPv6网络，即IPv6--IPv4--IPv6，当左边的IPv6网络通过中间的IPv4给右边的IPv6发送数据时，在数据到达IPv4以前会在原数据首部前再加一个IPv4首部，这样数据就可以在中间的IPv4网络中流动了，在数据到达右边的IPv6以前，数据会剥落之前加的IPv4首部，这样数据进入右边的IPv6网络后也可以流动了。