

## innodb存储引擎文件

### 重做日志文件

当数据库由于所在主机掉电导致实例失败，innodb存储引擎会使用重做日志恢复到掉电前的时刻，以此来保证数据的完整性。

innodb引擎至少有一个重做日志文件组，每个组内有至少两个日志文件。

为了提高可靠性，用户可以设置多个镜像日志组，将不同的文件组放在不同的磁盘上，以此提高重做日志的高可用性。

一组中先写日志文件1，文件1写满后再写日志文件2，当文件2 页写满时，再切换到文件1.

#### 与二进制日志区别

同样是记录事务日志，重做日志与二进制日志有什么区别：

1. 范围不同：二进制日志用于整个数据库，包括innodb、myisam等其他引擎。而innodb的重做日志只记录有关该存储引擎自身的事务日志。
2. 记录内容不同：无论二进制日志采用什么格式，都是记录关于一个事务的具体操作内容，即该日志的逻辑日志。innodb存储引擎的重做日志文件记录的是关于每个页的更改的物理情况。
3. 写入的时间也不同：二进制日志仅在事务提交前进行提交，即只写磁盘一次，不论事务多大；而重做日志在事务进行过程中，就不断的将重做日志写入到重做日志文件中，

####  格式

到innodb1.2.x版本为止共有51种类型，但是基本格式相同：

![1565698623391](C:\Users\PantaSun\AppData\Roaming\Typora\typora-user-images\1565698623391.png)

![1565698634010](C:\Users\PantaSun\AppData\Roaming\Typora\typora-user-images\1565698634010.png)

#### 写入

写入是先写入到重做日志buffer中而不是直接写。然后按照一定的条件顺序的写入日志文件。

由于从缓冲到磁盘的写入时是按照512字节，也就是和一个扇区的大小进行写入。因为扇区是写入的最小单位，因此可以保证写入必定是成功的。因此在缓冲到磁盘之间不需要double write。

