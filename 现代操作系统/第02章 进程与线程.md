## 进程

### 进程的创建

四种主要事件会导致进程的创建：

- 系统初始化
- 正在运行的程序执行了创建进程的系统调用
- 用户请求创建一个进程
- 一个批处理作业的初始化

一般创建新进程都是由一个已经存在的进程执行了一个用于创建新进程的系统调用（Unix中使用fork）来实现的。

这个新进程是调用进程的子进程，因此调用进程就是父进程。

父子进程拥有相同的内存映像、同样的环境字符串以及同样的打开文件。但是他们的地址空间是各自不同的。

子进程随后会执行execve或类似的系统调用以修改其内存影响并运行一个新的程序。

### 进程的状态

进程有三种状态：

- 运行态：就是该进程此刻占用CPU
- 就绪态：可运行，但因为其它进程正在运行而暂时停止。出现这种情况的主要是由系统设计造成的因为只有一个CPU，所以不能让一个进程一直占用CPU，这样会降低CPU的利用率。
- 阻塞态：程序自身挂起，需要某种外部事件来促进进程继续运行，如等待键盘输入。

四种转换关系：

- 一个正在运行的进程A因为程序需要而不能继续执行下去时就进入阻塞状态
- 一个正在运行的进程A因为被优先级高的进程B抢占CPU或者调度程序认为进程A已经使用足够长时间的CPU于是去调度其他进城从而使该程序A进入就绪状态
- 一个处在就绪状态的进程A被调度程序选中从而进入运行状态
- 一个处在阻塞状态的进程A接收到某个数据或经过某种事件触发进入到就绪状态，若目前没有正在运行的进程，该进程马上就从就绪转为运行。

### 进程的实现

操作系统会维持一张进程表，每一个进程占用表中的一个个表项。表项落实到代码中就是结构体。表项也称为进程控制块（process control block，PCB）。

**扩展：**

存放进程的管理和控制信息的数据结构称为进程控制块。它是进程管理和控制的最重要的数据结构，每一个进程均有一个PCB，在创建进程时，建立PCB，伴随进程运行的全过程，直到进程撤消而撤消。

在不同的操作系统中对进程的控制和管理机制不同，PCB中的信息多少也不一样，通常PCB应包含如下一些信息。

- 1、进程标识符PID：每个进程都必须有一个唯一的标识符，可以是字符串，也可以是一个数字。UNIX系统中就是一个整型数。在进程创建时由系统赋予。
- 2、进程当前状态 status：说明进程当前所处的状态。为了管理的方便，系统设计时会将相同的状态的进程组成一个队列，如就绪进程队列，等待进程则要根据等待的事件组成多个等待队列，如等待打印机队列、等待磁盘I/O完成队列等等。
- 3、进程相应的程序和数据地址，以便把PCB与其程序和数据联系起来。
- 4、进程资源清单。列出所拥有的除CPU外的资源记录，如拥有的I/O设备，打开的文件列表等。
- 5、进程优先级 priority：进程的优先级反映进程的紧迫程序，通常由用户指定和系统设置。UNIX系统采用用户设置和系统计算相结合的方式确定进程的优先级 。
- 6、CPU现场保护区 cpustatus：当进程因某种原因不能继续占用CPU时（等待打印机），释放CPU，这时就要将CPU的各种状态信息保护起来，为将来再次得到处理机恢复CPU的各种状态，继续运行。
- 7、进程同步与通信机制 用于实现进程间互斥、同步和通信所需的信号量等。
- 8、进程所在队列PCB的链接字
  根据进程所处的现行状态，进程相应的PCB参加到不同队列中。PCB链接字指出该进程所在队列中下一个进程PCB的首地址。
- 9、与进程有关的其他信息。 如进程记账信息，进程占用CPU的时间等。



### 本节总结

进程和线程