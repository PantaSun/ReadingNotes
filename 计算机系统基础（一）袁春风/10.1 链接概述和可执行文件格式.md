###  一个c语言文件从.c文件到可执行文件的转化过程主要有四个过程：
- 预处理
- 编译
- 汇编
- 链接

----



### 预处理
#### 预处理器
预处理使用的是预处理器，在Linux（GUN编译器套件）中的shell环境下使用`gcc -E source.c -o target.i`命令可以将`.c`文件转化成`.i`文件。也可以使用预处理命令`cpp source.c > target.i`

##### 总结预处理命令：

- `gcc -E source.c -o target.i`
- `cpp source.c > target.i`

#### 预处理过程

##### 主要处理.c源文件中的以`#`井号开头的预编译指令语句：

- 先删除所有#define，并展开所有宏定义。展开宏定义就是将宏定义进行文本替换，例如宏定义`#define DATASIZE 20`在进行预处理时，会将程序代码中的所有的`DATASIZE`都替换为`20`，但是字符串中的`DATASIZE`除外(如`char a[] = "DATASIZE is ...";`就不会变成`char a[] = "20 is ...";`)
- 处理所有条件预编译指令：`#if`，`#ifdef`，`ifndef`，`else`，`elif`，`#endif`等。这些指令使用方式和普通的条件语句类似。使用这些条件预编译指令的好处是，可以根据不同的宏定义来处理不同的代码块。
- 处理`#include`头文件包含指令。就是将inlcude指令中指定的文件全部代码插入到该语句的所在位置。并且这些插入的文件也会递归的执行预处理。
- 保留所有`#pragma`编译指令，因为这些指令会在编译时使用。

##### 除了处理带井号的预编译指令外，预处理还进行其他工作：

- 删除所有注释，即删除被`//`或者`/**/`包含的部分以及这些注释符号。
- 添加行号和文件标识，方便编译时编译器产生调试用的行号信息。

#### 预处理结果

预处理后的`.i`文件仍然是可读文件但不包含任何宏定义，机器仍然是无法识别的。 

#### 关于插入头文件：
使用头文件的主要目的是可以使一个文件中的定义被多个其他文件使用。而在引入头文件时的搜索规则如下：
- 所有的头文件的搜索会从`-I`开始。`-I`就是在shell环境下使用gcc时的命令行参数，指定头文件寻找的第一个目录。
- 然后从gcc的环境变量 `C_INCLUDE_PATH`,`CPLUS_INCLUDE_PATH`,`OBJC_INCLUDE_PATH` （这些变量在windows下对应的是include环境变量）。
- 最后再找默认目录（`/usr/include`, `/usr/local/include`, `/usr/lib/gcc-lib/xxxx-linux/x.xx.x/include` 等等）

----



### 编译

#### 编译器

编译使用的是编译器，在Linux（GNU编译器套件）中的shell环境下使用`gcc -S source.i -o target.s`命令可以将预处理后得到的预处理文件（`.i`）转化为汇编代码文件（`.s`）；也可以使用`gcc -S source.c -o target.s`命令将`.c`文件进行预处理并且编译成汇编代码文件，即将预处理和编译两个过程一起来做。当然也可以使用`/user/lib/gcc/i486-linux-gun/x.x/cc1 source.c`命令直接进行预处理及编译，默认生成`source.s`。

##### 总结编译命令：

- `gcc -S source.i -o target.s`
- `gcc -S source.c -o target.s`
- `/user/lib/gcc/i486-linux-gun/x.x/cc1 source.c`

#### 编译过程

所谓编译，就是将预处理后的**预处理文件**进行词法分析、语法分析、语义分析并优化，生成包含汇编指令的**汇编代码文件**。

#### 编译结果

编译后得到的汇编代码文件还是可读的文本文件，CPU仍然无法理解和直接执行它。

----



### 汇编

#### 汇编器（汇编程序）

汇编使用汇编器，在Linux（GNU编译器套件）中的shell环境下使用`gcc -c source.s -o target.o`命令可以将编译后得到的汇编代码文件（`.s`，又叫汇编语言源程序）转化为机器指令序列（`.o`，又叫机器语言程序）；也可以使用`gcc -c source.c -o target.o`命令将`.c`文件进行预处理、编译以及汇编成机器指令序列，即将预处理、编译和汇编三个过程一起来做。当然也可以使用`as source.c -o target.o`命令。

##### 总结汇编指令：

- `gcc -c source.s -o target.o`
- `gcc -c source.c -o target.o`
- `as source.c -o target.o`

#### 汇编过程

汇编指令和机器指令一一对应，汇编指令是机器指令的符号表示，它们都属于机器级指令，所构成的程序称为机器级代码

#### 汇编结果

汇编结果是一个可重定位目标文件，这个文件是不可读的二进制代码。这个文件一般来说还不能马上运行，因为还要和其他的目标文件进行链接。

目标文件由段组成，通常一个目标文件中有两个段：

- 代码段：包含程序的指令。该段一般可读可执行，但一般不可写
- 数据段：存放程序要用到的各种全局变量或静态的数据。一般可读可写可执行。

----



### 链接

#### 链接器

将可重定位目标文件(`.o`)以及所需静态库(`lib.a`)经过链接器的处理(`gcc` 或 `ld`)最终成为计算机可执行的程序。在Linux（GNU编译器套件）中的shell环境下直接使用`gcc`加上需要链接的可重定位目标文件即可，若不是用`-o`选项，则可执行文件默认的文件名为`a.out`。也可以使用`ld`命令。

##### 总结链接命令：

- `gcc -static -o target source1.o source2.o`

- `ld -static -o target source1.o source2.o`

  `-static`表示静态链接，当然也存在动态链接。

#### 链接过程

预处理、编译以及汇编都是针对一个模块（一个.c文件）进行处理，得到的是一个可重定位目标文件；而链接是将多个可重定位目标文件合并生成可执行目标文件。

#### 链接结果

链接结果是得到一个可执行目标文件。

gcc命令：就是ccp，cc1，as等命令的包装命令。用户可以通过gcc命令来使用具体的预处理程序ccp、编译程序cc1和汇编程序as等。而且相应的可以加上命令参数。

