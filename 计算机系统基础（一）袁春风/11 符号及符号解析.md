> 在链接过程中第一步是符号解析，所谓符号解析就是将符号的定义与符号的引用关联起来，那么什么是符号的定义与引用？

###  符号

符号包括函数和变量（局部非静态变量除外，这块不归链接器管，是在运行的时候在运行栈中分配空间）

下面几个例子说明定义的符号和引用的符号

```c
// main.c

// 符号定义 swap
void swap(...){ 
    ....
}

// 若符号定义 test
void test();

// 符号定义 x
int x = 10;

// 符号定义 xp，符号引用 x
int *xp = &x;

// 符号定义 main
int main(){
    // 局部变量，链接器不认，不会被外界引用，因此不是符号定义
    int y = 11;
    // 符号引用 swap
    swap(...);
}
```

上述代码说明，除了局部非静态变量，凡是带类型说明的都是定义，其他的都是引用。

编译器将**定义的符号**存放在符号表中，即在`.symtab`节中，每个表项包含符号名、长度和位置等信息

编译器将**引用的符号**存放在重定位节中（`.rel.text `  和 `.rel.data`）中

链接器的工作就是将每个符号的引用都与一个确定的符号定义相关联。

##### 符号的定义：

是指被分配了存储空间。

函数名即指：其代码所在区

变量名即指：其所占的静态数据区

所有定义符号的值就是其所在的首地址

#### 符号分类

模块：指可重定位模块m

- 全局符号（Global symbols）
  - 模块内部定义的并能被其他模块引用的符号
  - 非static C函数和非static 的C全局变量
- 外部符号（External symbols）
  - 由其他模块定义的并被本模块引用的全局符号
- 局部符号（Local symbols）
  - 仅有本模块定义且只在本模块中引用的本地符号
  - 在模块中定义的statc的C函数和C变量
  - 这里的局部不是指C语言中的局部变量，而是只放在静态区的变量l

##### 全局符号的强弱

- 首先看是否是全局的符号


- 符号的定义才有强弱之分，而符号的引用没有


- 函数的定义和已初始化的全局变量名是强符号
- 未初始化的全局变量名是弱符号
- 函数的原型声明是弱符号

#### 连接器对符号解析的规则

##### 多重定义符号的规则

- 强符号不能定义多次，即强符号只能被定义一次，否则就会发生链接错误
- 若一个符号被定义为一次强符号和多次弱符号，则按强符号定义为准。即对弱符号的引用解析为其强符号的定义
- 若有多个弱符号定义，则任选一个。在链接时，使用`gcc -fno-common`命令时，会告诉链接器在遇到多个弱定义的全局符号时输出一条警告信息。
- 符号解析时最终只能有一个定义

**如果可能，尽量避免使用全局变量**

如果一定要用的话，注意下面几点：

- 使用静态变量
- 定义全局变量的时候初始化
- 注意使用 `extern` 关键字