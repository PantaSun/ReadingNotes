三种基本IO方式

- 程序直接控制方式：
  - 无条件传送：对简单外设定时（同步）进行数据传送
  - 条件传送：CPU主动查询，也称为程序查询或轮询
- I/O Interrupt（中断I/O方式）：几乎所有系统都支持中断I/O方式。若一个I/O设备需要CPU干预，它就通过中断请求通知CPU，CPU终止当前程序的执行，调出OS（中断处理程序）来执行，处理结束后，再返回到被中止的程序继续执行
- Direct memory access（DMA方式）：磁盘等高速外设所用的方式。数据传送无需CPU参与。

## 程序查询方式

I/O设备（包括设备控制器）将自己的状态放在状态寄存器中，比如打印机缺纸、打印机忙、未就绪等都是状态。

OS阶段性的查询寄存器中的特定状态，已决定下一步动作，如“未就绪”时，就会一直等待。

所谓等待不是说CPU停止执行指令了，相反是在不停的在执行查询指令。

工作方式：完全串行或部分串行，CPU用百分百的时间为I/O服务。



## 中断I/O方式

 基本思想：当外设准备好时，便向CPU发中断请求，CPU相应后，中止（不是终止，中止是暂时停止）现在运行的程序的执行，转入“中断服务程序”进行输入/输出操作，以实现外设和主机之间的数据传送，并启动外设工作。“中断服务程序”执行完毕后，返回原先被中止的程序断点处继续执行。此时CPU和外设并行工作。

程序切换（响应中断）由硬件完成，即执行中断隐指令。

#### 中断响应的条件

1. CPU处于开中断状态
2. 在一条指令执行完
3. 至少要有一个未被屏蔽的中断请求

#### 中断响应的时点与异常处理的时点是否相同？为什么？

通常在指令执行结束时查询有无中断请求，有则立即响应

而异常发生在指令执行过程中，一旦发现则马上处理



## 中断处理过程

中断响应的结果是调出相应的中断服务程序

中断处理是指执行相应中断服务程序的过程：

- 不同的中断源其对应的中断服务程序不同
- 典型的多重中断处理分为三个阶段
  - 先行段也叫准备阶段
    - 保护现场及旧屏蔽字
    - 查明原因（软件中断时使用）
    - 设置新屏蔽字
    - 开中断（若是单重中断处理，这里就不会开中断了）
  - 本体段：具体的中断处理阶段
  - 结束段：恢复阶段
    - 关中断（若是单重中断，因为在上面先行段没有开中断，所以这里也就不需要关中断了）
    - 恢复现场及旧屏蔽字
    - 清中断请求
    - 开中断（这个是必要的）
    - 中断返回

在中断响应时，是要关中断的，而在多重中断处理中可以看到在准备阶段将关掉的中断打开了，也就是允许在中断处理过程中响应新的中断，这也就是中断嵌套，即多重中断。但是在恢复阶段开始时一定要先关中断，避免响应新的中断时，影响了现场的恢复。

在单重中断时，由于在执行中断服务程序之前就已经关中断了，所以就没必要在处理时打开了，只有在恢复后打开中断就可以了。

中断的开关软件和硬件都能进行。硬件通过设置IF标志位来开关中断，而软件通过相应的指令也能开关中断。