## Linux中对IDT的初始化

- Linux利用陷阱门来处理异常，利用中断门来处理中断
- 异常和中断对应的处理程序都属于内核代码段，所以，所有中断门和陷阱门的段选择符都指向GDT中的“内核代码段”描述符
- 通过中断门进入一个中断服务程序后，CPU会清楚EFLAGS及承诺其中的IF标志，即关中断
- 通过陷阱门进入一个异常处理程序时，CPU不会修改IF标志。也就是说外部中断不支持嵌套处理，而内部异常则支持嵌套处理。因为处理异常时是执行内核代码指令，也可能发生异常，如缺页等，如果把异常关掉了，就无法响应新出现的异常了。

### 初始化IDT

Linux运用硬件提供的三种门描述符格式，构造了5种类型的门描述符：

- 中断门：DPL=0，TYPE=1110B。激活所有中断
- 系统门：DPL=3，TYPE=1111B。激活4（溢出）、5（边界检查）和128（系统调用）三个陷阱异常。因为DPL=3，CPL小于等于DPL，所以用户态下可以使用这三条指令。
- 系统中断门：DPL=3，TYPE=1110B。激活3号中断（断点调试）对应指令int 3。因为DPL=3，CPL小于等于DPL，所以用户态下可以使用int 3指令。
- 陷阱门：DPL=0，TYPE=1111B。激活所有内部异常，并阻止用户程序使用INT n（n不等于3或128）指令来模拟非法异常来陷入内核态。
- 任务门：DPL=0，TYPE=0101B。激活8号中断（双重故障）。

Linux内核在启用中断机制之前，先设置好IDT，并把IDT首地址放入IDTR。系统初始化时，Linux完成对GDT、GDTR、TDT和IDTR等的设置，以后一旦发生异常或中断，CPU就可以通过异常和中断响应机制调出中断或异常处理程序执行。

